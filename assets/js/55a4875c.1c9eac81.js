"use strict";(self.webpackChunksunsboyxu_docs=self.webpackChunksunsboyxu_docs||[]).push([[6889],{7604:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>r});var s=t(3274),o=t(1377);const l={},a="State & \u751f\u547d\u5468\u671f",c={id:"webs/react/React-lifecycle",title:"State & \u751f\u547d\u5468\u671f",description:"- State & \u751f\u547d\u5468\u671f",source:"@site/docs/webs/react/4-React-lifecycle.md",sourceDirName:"webs/react",slug:"/webs/react/React-lifecycle",permalink:"/yogeexu-docs/webs/react/React-lifecycle",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"react\u7ec4\u4ef6\u5e93",permalink:"/yogeexu-docs/webs/react/React-component-ui"},next:{title:"Redux",permalink:"/yogeexu-docs/webs/react/Redux"}},i={},r=[{value:"\u6b63\u786e\u4f7f\u7528 setState",id:"\u6b63\u786e\u4f7f\u7528-setstate",level:2},{value:"\u5173\u4e8e setState \u5e94\u8be5\u4e86\u89e3\u4e09\u4ef6\u4e8b",id:"\u5173\u4e8e-setstate-\u5e94\u8be5\u4e86\u89e3\u4e09\u4ef6\u4e8b",level:3},{value:"\u83b7\u53d6 state \u6700\u65b0\u72b6\u6001\u503c\u6709\u4ee5\u4e0b\u2f45\u5f0f",id:"\u83b7\u53d6-state-\u6700\u65b0\u72b6\u6001\u503c\u6709\u4ee5\u4e0b\u5f0f",level:3},{value:"\u751f\u547d\u5468\u671f",id:"\u751f\u547d\u5468\u671f",level:2},{value:"v16.3\u4e4b\u524d\u7684\u2f63\u547d\u5468\u671f",id:"v163\u4e4b\u524d\u7684\u547d\u5468\u671f",level:3},{value:"v16.4\u4e4b\u540e\u7684\u2f63\u547d\u5468\u671f",id:"v164\u4e4b\u540e\u7684\u547d\u5468\u671f",level:3},{value:"v17\u53ef\u80fd\u4f1a\u5e9f\u5f03\u7684\u4e09\u4e2a\u2f63\u547d\u5468\u671f",id:"v17\u53ef\u80fd\u4f1a\u5e9f\u5f03\u7684\u4e09\u4e2a\u547d\u5468\u671f",level:3},{value:"\u65b0\u589e2\u4e2a\u751f\u547d\u5468\u671f",id:"\u65b0\u589e2\u4e2a\u751f\u547d\u5468\u671f",level:3},{value:"getDerivedStateFromProps",id:"getderivedstatefromprops",level:3},{value:"getSnapShotBeforeUpdate",id:"getsnapshotbeforeupdate",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"state--\u751f\u547d\u5468\u671f",children:"State & \u751f\u547d\u5468\u671f"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://zh-hans.reactjs.org/docs/state-and-lifecycle.html",children:"State & \u751f\u547d\u5468\u671f"})}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u6b63\u786e\u4f7f\u7528-setstate",children:"\u6b63\u786e\u4f7f\u7528 setState"}),"\n",(0,s.jsx)(n.p,{children:"setState(partialState, callback)"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u53c2\u6570"}),(0,s.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"partialState"}),(0,s.jsx)(n.td,{children:"\u2f64\u4e8e\u4ea7\u2f63\u4e0e\u5f53\u524dstate\u5408\u5e76\u7684\u2f26\u96c6\uff08object\u6216function(state, props)\uff09"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"callback"}),(0,s.jsx)(n.td,{children:"state\u66f4\u65b0\u4e4b\u540e\u88ab\u8c03\u2f64\uff08function\uff09"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"\u5173\u4e8e-setstate-\u5e94\u8be5\u4e86\u89e3\u4e09\u4ef6\u4e8b",children:"\u5173\u4e8e setState \u5e94\u8be5\u4e86\u89e3\u4e09\u4ef6\u4e8b"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"1 \u4e0d\u8981\u76f4\u63a5\u4fee\u6539 State\uff0c\u5426\u5219\u4e0d\u4f1a\u91cd\u65b0\u6e32\u67d3\u7ec4\u4ef6\uff0c\u5e94\u8be5\u4f7f\u7528 setState"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// \u9519\u8bef\nthis.state.userinfo.username = 'askaxu'\n// \u6b63\u786e\nthis.setState({\n userinfo: {\n  username: 'askaxu'\n }\n})\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"2 state \u7684\u66f4\u65b0\u53ef\u80fd\u662f\u5f02\u6b65\u7684\n\u51fa\u4e8e\u6027\u80fd\u8003\u8651\uff0cReact \u53ef\u80fd\u4f1a\u628a\u591a\u4e2a setState() \u8c03\u2f64\u5408\u5e76\u6210\u2f00\u4e2a\u8c03\u2f64\uff0c\nsetState\u53ea\u6709\u5728\u5408\u6210\u4e8b\u4ef6\u548c\u2f63\u547d\u5468\u671f\u51fd\u6570\u4e2d\u662f\u5f02\u6b65\u7684\uff0c\n\u5728\u539f\u2f63\u4e8b\u4ef6\u548csetTimeout\u4e2d\u90fd\u662f\u540c\u6b65\u7684\uff0c\u8fd9\u2fa5\u7684\u5f02\u6b65\u5176\u5b9e\u662f\u6279\u91cf\u66f4\u65b0"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u83b7\u53d6-state-\u6700\u65b0\u72b6\u6001\u503c\u6709\u4ee5\u4e0b\u5f0f",children:"\u83b7\u53d6 state \u6700\u65b0\u72b6\u6001\u503c\u6709\u4ee5\u4e0b\u2f45\u5f0f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:"- 1 \u5728 setState(partialState, callback)\u7684\u56de\u8c03\u4e2d\u83b7\u53d6\u6700\u65b0\u7684\u72b6\u6001\u503c\n- 2 \u4f7f\u7528\u5b9a\u65f6\u5668 setTimeout(() => { .... }, 0)\n- 3 \u5728 componentDidMount \u4e2d\u4f7f\u7528 \u539f\u751f\u4e8b\u4ef6\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import React, { Component } from 'react'\n\nclass SetStatePage extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      userinfo: {\n        username: 'sunsboyxu'\n      },\n      count: 0\n    }\n  }\n\n  changeUsername = () => {\n    console.log(this)\n    this.setState({\n      userinfo: {\n        username: 'askaxu'\n      }\n    })\n  }\n\n  changeValue = val => {\n    this.setState({\n      count: this.state.count + val\n    }, () => {\n      // \u6d4b\u8bd5\u7b2c\u4e8c\u6b65\n      console.log('\u6d4b\u8bd5\u7b2c\u4e8c\u6b65,\u56de\u8c03\u4e2d\u83b7\u53d6\u72b6\u6001\u503c')\n      console.log('count:', this.state.count)\n    })\n  }\n\n  setCount = () => {\n    // \u6d4b\u8bd5\u7b2c\u4e00\u6b65\n    this.changeValue(1)\n    // this.changeValue(2)\n    // \u6253\u5370 count ,\u53d1\u73b0\u8fd8\u662f\u4e0a\u6b21\u7684\u503c\uff0c\u53ef\u4ee5\u5728 setState(partialState, callback)\u7684\u56de\u8c03\u4e2d\u83b7\u53d6\u6700\u65b0\u7684\u72b6\u6001\u503c\n    console.log('\u6d4b\u8bd5\u7b2c\u4e00\u6b65')\n    console.log('\u83b7\u53d6\u72b6\u6001\u503c')\n    console.log('count:', this.state.count)\n  }\n\n  setCount2 = () => {\n    setTimeout(() => {\n      this.changeValue(1)\n      console.log('\u6d4b\u8bd5\u7b2c\u4e09\u6b65')\n      console.log('count:', this.state.count)\n    }, 0)\n  }\n\n  componentDidMount() {\n    document.querySelector('#btn-count').addEventListener('click', () => {\n      console.log('\u6d4b\u8bd5\u7b2c\u56db\u6b65\uff0c\u539f\u751f\u4e8b\u4ef6\u5904\u7406')\n      this.setCount()\n    }, false)\n  }\n\n  // \u4e8b\u4ef6\u88ab\u5408\u5e76\n  changeValue3 = val => {\n    this.setState({\n      count: this.state.count + val\n    })\n  }\n\n  setCount3 = () => {\n    // \u53ea\u4f1a\u6267\u884c\u52a02 \u7684\u64cd\u4f5c\n    this.changeValue3(1)\n    this.changeValue3(2)\n  }\n\n  // \u5982\u679c\u60f3\u8981\u94fe\u5f0f\u66f4\u65b0 state\n  changeValue4 = val => {\n    console.log('\u94fe\u5f0f\u66f4\u65b0\u7684val:' + val)\n    this.setState((state) => ({count: state.count + val}))\n  }\n  setCount4 = () => {\n    // \u652f\u6301\u540c\u65f6\u52a01\uff0c\u5e76\u4e14\u52a02 \u7684\u64cd\u4f5c\n    this.changeValue4(1)\n    this.changeValue4(2)\n  }\n\n  render() {\n    const { userinfo, count } = this.state\n    return (\n      <div>\n        <h4>\u6b63\u786e\u4f7f\u7528 setState</h4>\n        <p>{userinfo.username}</p>\n        <div>\n          <button onClick={() => this.changeUsername()}>\u4fee\u6539 state</button>\n        </div>\n        <h4>Count: <span>{count}</span></h4>\n        <div>\n          <button onClick={this.setCount}>\u4fee\u6539 count 1</button>\n          <button onClick={this.setCount2}>\u4fee\u6539 count-\u4f7f\u7528setTimeout</button>\n          <button id='btn-count'>\u539f\u751f\u4e8b\u4ef6\u4fee\u6539 count</button>\n          <button onClick={this.setCount3}>\u4e8b\u4ef6\u88ab\u5408\u5e76</button>\n          <button onClick={this.setCount4}>\u94fe\u5f0f\u66f4\u65b0 state</button>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default SetStatePage\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"3 state \u7684\u66f4\u65b0\u4f1a\u88ab\u5408\u5e76\n\u5728\u67d0\u4e2a\u4e8b\u4ef6\u4e0a\uff0c\u540c\u65f6\u8c03\u7528\u591a\u4e2a setState \u65f6\uff0c\u72b6\u6001\u503c\u7684\u66f4\u65b0\u4f1a\u88ab\u5408\u5e76\uff0c\n\u6267\u884c setState\u65f6\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f7f\u7528 \u51fd\u6570\u6765\u89e6\u53d1\u94fe\u5f0f\u7684\u66f4\u65b0"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// \u94fe\u5f0f\u66f4\u65b0 state\n  changeValue4 = val => {\n    console.log('\u94fe\u5f0f\u66f4\u65b0\u7684val:' + val)\n    this.setState((state, props) => ({count: state.count + val}))\n  }\n  setCount4 = () => {\n    // \u652f\u6301\u540c\u65f6\u52a01\uff0c\u5e76\u4e14\u52a02 \u7684\u64cd\u4f5c\n    this.changeValue4(1)\n    this.changeValue4(2)\n  }\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u751f\u547d\u5468\u671f",children:"\u751f\u547d\u5468\u671f"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://zh-hans.reactjs.org/docs/react-component.html#the-component-lifecycle",children:"\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u2f63\u547d\u5468\u671f\u2f45\u6cd5\uff0c\u2f64\u4e8e\u5728\u7ec4\u4ef6\u4e0d\u540c\u9636\u6bb5\u6267\u2f8f\u2f83\u5b9a\u4e49\u529f\u80fd\u3002\n\u5728\u7ec4\u4ef6\u88ab\u521b\u5efa\u5e76\u63d2\u2f0a\u5230 DOM \u65f6\uff08\u5373\u6302\u8f7d\u4e2d\u9636\u6bb5\uff08mounting\uff09\uff09\uff0c\n\u7ec4\u4ef6\u66f4\u65b0\u65f6\uff0c\u7ec4\u4ef6\u53d6\u6d88\u6302\u8f7d\u6216\u4ece DOM \u4e2d\u5220\u9664\u65f6\uff0c\u90fd\u6709\u53ef\u4ee5\u4f7f\u2f64\u7684\u2f63\u547d\u5468\u671f\u2f45\u6cd5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:"- UNSAFE_componentWillMount\n- UNSAFE_componentWillUpdate\n- UNSAFE_componentWillUnMount\n- componentDidMount() {} // \u7ec4\u4ef6\u6302\u8f7d\n- shouldComponentUpdate(props, state) {\n  // \u63a7\u5236\u7ec4\u4ef6\u662f\u5426\u66f4\u65b0\uff0c\u9700\u8981 \u8fd4\u56de true/false\n  return true\n }\n- componentDidUpdate() {} // \u7ec4\u4ef6\u66f4\u65b0\n- componentReciveProps(nextProps) {\n  // \u521d\u6b21\u6e32\u67d3\u4e0d\u4f1a\u6267\u884c\uff0c\u53ea\u6709\u5728\u5df2\u6302\u8f7d\u7684\u7ec4\u4ef6\u63a5\u6536\u65b0\u7684props\u65f6\u624d\u4f1a\u6267\u884c\n }\n- componentUnMount() {}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"v163\u4e4b\u524d\u7684\u547d\u5468\u671f",children:"v16.3\u4e4b\u524d\u7684\u2f63\u547d\u5468\u671f"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.img,{alt:"V16.3\u4e4b\u524d\u7684\u2f63\u547d\u5468\u671f",src:t(4690).A+"",width:"655",height:"857"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"v164\u4e4b\u540e\u7684\u547d\u5468\u671f",children:"v16.4\u4e4b\u540e\u7684\u2f63\u547d\u5468\u671f"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/",children:"v16.4\u4e4b\u540e\u7684\u2f63\u547d\u5468\u671f"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"v17\u53ef\u80fd\u4f1a\u5e9f\u5f03\u7684\u4e09\u4e2a\u547d\u5468\u671f",children:"v17\u53ef\u80fd\u4f1a\u5e9f\u5f03\u7684\u4e09\u4e2a\u2f63\u547d\u5468\u671f"}),"\n",(0,s.jsx)(n.p,{children:"V17\u53ef\u80fd\u4f1a\u5e9f\u5f03\u7684\u4e09\u4e2a\u2f63\u547d\u5468\u671f\u51fd\u6570\u2f64 getDerivedStateFromProps \u66ff\u4ee3\uff0c\u2f6c\u524d\u4f7f\u2f64\u7684\u8bdd\u52a0\u4e0a UNSAFE_"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"componentWillMount"}),"\n",(0,s.jsx)(n.li,{children:"componentWillReceiveProps"}),"\n",(0,s.jsx)(n.li,{children:"componentWillUpdate"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"UNSAFE_componentWillMount() {\n console.log('componentWillMount--')\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u4e0d\u60f3\u2f3f\u52a8\u7ed9\u5c06\u8981\u5e9f\u5f03\u7684\u2f63\u547d\u5468\u671f\u6dfb\u52a0 UNSAFE_ \u524d\u7f00\uff0c\u53ef\u4ee5\u2f64\u4e0b\u2faf\u7684\u547d\u4ee4"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"npx react-codemod rename-unsafe-lifecycles <path>\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u65b0\u589e2\u4e2a\u751f\u547d\u5468\u671f",children:"\u65b0\u589e2\u4e2a\u751f\u547d\u5468\u671f"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"static getDerivedStateFromProps"}),"\n",(0,s.jsx)(n.li,{children:"getSnapshotBeforeUpdate"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"getderivedstatefromprops",children:"getDerivedStateFromProps"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"static getDerivedStateFromProps(props, state) {\n console.log('\u7236\u7ec4\u4ef6getDerivedStateFromProps--')\n console.log('props', props)\n console.log('state', state)\n const { count } = state\n return count > 10 ? { count: 0 } : null\n}\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5728\u8c03\u2f64 render \u2f45\u6cd5\u4e4b\u524d\u8c03\u2f64"}),"\n",(0,s.jsx)(n.li,{children:"\u5728\u521d\u59cb\u6302\u8f7d\u53ca\u540e\u7eed\u66f4\u65b0\u65f6\u90fd\u4f1a\u88ab\u8c03\u2f64"}),"\n",(0,s.jsx)(n.li,{children:"\u5b83\u5e94\u8fd4\u56de\u2f00\u4e2a\u5bf9\u8c61\u6765\u66f4\u65b0 state\uff0c\u5982\u679c\u8fd4\u56de null \u5219\u4e0d\u66f4\u65b0\u4efb\u4f55\u5185\u5bb9"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u8bf7\u6ce8\u610f\uff0c\u4e0d\u7ba1\u539f\u56e0\u662f\u4ec0\u4e48\uff0c\u90fd\u4f1a\u5728\u6bcf\u6b21\u6e32\u67d3\u524d\u89e6\u53d1\u6b64\u2f45\u6cd5\n\u8fd9\u4e0e UNSAFE_componentWillReceiveProps \u5f62\u6210\u5bf9\u2f50\uff0c\u540e\u8005\u4ec5\u5728\u2f57\u7ec4\u4ef6\u91cd\u65b0\u6e32\u67d3\u65f6\u89e6\u53d1\uff0c\u2f7d\u4e0d\u662f\u5728\u5185\u90e8\u8c03\u2f64 setState \u65f6"}),"\n",(0,s.jsx)(n.h3,{id:"getsnapshotbeforeupdate",children:"getSnapShotBeforeUpdate"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"getSnapShotBeforeUpdate(preProps, preState) { }\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728 render \u4e4b\u540e\uff0ccomponentDidUpdate \u4e4b\u524d,\ngetSnapshotBeforeUpdate() \u5728\u6700\u8fd1\u2f00\u6b21\u6e32\u67d3\u8f93\u51fa\uff08\u63d0\u4ea4\u5230 DOM \u8282\u70b9\uff09\u4e4b\u524d\u8c03\u2f64\n\u5b83\u4f7f\u5f97\u7ec4\u4ef6\u80fd\u5728\u53d1\u2f63\u66f4\u6539\u4e4b\u524d\u4ece DOM \u4e2d\u6355\u83b7\u2f00\u4e9b\u4fe1\u606f\uff08\u4f8b\u5982\uff0c\u6eda\u52a8\u4f4d\u7f6e\uff09\n\u6b64\u2f63\u547d\u5468\u671f\u7684\u4efb\u4f55\u8fd4\u56de\u503c\u5c06\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9 componentDidUpdate(prevProps, prevState, snapshot)"})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},4690:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/lifeCycle-c5bcf9efa8763677fe73d196db59bb44.png"},1377:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var s=t(9474);const o={},l=s.createContext(o);function a(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);